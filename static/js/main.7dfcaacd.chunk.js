(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{158:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),i=a(9),o=a.n(i),l=(a(95),a(50)),s=a(89),c=a(47),u=a(48),h=a(52),d=a(49),p=a(18),f=a(51),m=(a(96),a(97),a(98),a(30)),b=a.n(m),g=a(88),v=(a(61),a(22)),x=a(83),y=a.n(x),w=(a(99),a(4)),D=a(32),O=a(87),C=(a(159),a(14)),j=a(84),M=a(2),P=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(h.a)(this,Object(d.a)(e).call(this,t))).createChart=a.createChart.bind(Object(p.a)(a)),a.state={height:4e3},a}return Object(f.a)(e,t),Object(u.a)(e,[{key:"componentDidMount",value:function(){this.setState({height:180*this.props.data.length}),this.createChart()}},{key:"componentDidUpdate",value:function(){this.createChart()}},{key:"componentWillReceiveProps",value:function(t){t.data!==this.props.data&&this.setState({height:180*t.data.length})}},{key:"createChart",value:function(){var t=this.props.data?this.props.data:[],e=this.props,a=e.revAsCircles,n=e.timeline,r={top:150,right:5,bottom:5,left:this.props.width/3},i=this.props.width-r.left-r.right,o=this.state.height-r.top-r.bottom,l=Object(w.a)(this.node);console.log(t),console.log(a),(t=b.a.sortBy(t,"Date_of_sale")).forEach(function(t){t.yRevBottom=0,t.yRevTop=0});var s=Object(C.a)(",.2f"),c=Object(D.a)().range([o,0]),u=Object(D.a)().range([o,0]),h={xOffset:0,yOffset:0,width:i/8,height:o,labelPositioning:{alpha:.5,spacing:18},leftTitle:"Lifting",rightTitle1:"Buyer",rightTitle2:"& Destination",leftSubTitle:"Date of Sale",rightSubTitle:"Payment Due Date",labelGroupOffset:5,labelKeyOffset:50,radius:6,subTitleYShift:20,unfocusOpacity:.3,revWidthMultiple:3.5,priceWidthMultiple:1.5,timelineWidthMultiple:.6},d={maxwidth:i/15>20?i/15:20,height:10,color:"#ecb600",highlightColor:"#CE1126",border:"#eee",volWidth:2.5,revBoxesPerCol:10,maxRevWidth:400,volTitle:"Volume (barrels)",priceTitle1:"Price",priceTitle2:"(US$)",revTitle1:"Revenue",revTitle2:"(US$)"},p=Object(j.a)().attr("class","d3-tip").offset([0,20]).direction(function(t){return a?"e":"se"}).html(function(t){return function(t,e){var a="<div class='tootltip' style='font-size:12px; border: 1px solid #ccc; background-color: rgba(255,255,255,0.9); padding:5px; max-width:350px; z-index:2000'>";return a+=t?"<div style='font-size:20px'>"+t+"</div>":"",e&&e.forEach(function(t){a+="<br/><strong>"+t.label+":</strong> ",a+="<div class='tootltip-value' style='font-size:18px;'>"+t.value+"</div>"}),a+="</div>"}(t.year,[{label:"Lifting",value:t.Lifting},{label:"Date of Sale",value:t.Date_of_sale.format("D MMM YYYY")},{label:"Payment Receipt Date",value:t.Payment_receipt_date.format("D MMM YYYY")},{label:"Price",value:"US$ "+s(t.Price)+" per barrel"},{label:"Volume",value:s(t.Volume)+" barrels"},{label:"Revenue",value:"US$ "+s(t.Revenue)},{label:"Buyer",value:t.Buyer},{label:"Destination",value:t.Destination}])});l.selectAll("g").remove();Object(D.b)(O.a).domain([0,10]);var f=function(t,e){return n?c(t):u(e)},m=v(v.max(t.map(function(t){return t.Payment_receipt_date})).toDate()),g=v(v.min(t.map(function(t){return t.Date_of_sale})).toDate());c.domain([m.add(2,"months").toDate(),g.subtract(1,"months").toDate()]),u.domain([t.length,-1]);var x=l.append("g").attr("class","border-lines").attr("transform","translate("+r.left+","+r.top+")");x.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",h.height),x.append("line").attr("x1",h.width*h.timelineWidthMultiple).attr("y1",0).attr("x2",h.width*h.timelineWidthMultiple).attr("y2",h.height);var y=l.append("g").selectAll("g").data(t).enter().append("g").attr("transform","translate("+r.left+","+r.top+")").attr("class","slope-group").attr("id",function(t,e){t.id="group"+t.Lifting,t.sellDate=t.Date_of_sale.toDate(),t.paymentDate=t.Payment_receipt_date.toDate()}),P=(y.append("line").attr("class","slope-line").attr("x1",0).attr("y1",function(t,e){return f(t.sellDate,e)}).attr("x2",h.width*h.timelineWidthMultiple).attr("y2",function(t,e){return f(t.paymentDate,e)}),y.append("circle").attr("class",function(t){return"circle"}).attr("r",h.radius).attr("cy",function(t,e){return f(t.sellDate,e)}),y.append("g").attr("class","slope-label-left").each(function(t,e){t.xLeftPosition=-h.labelGroupOffset,t.yLeftPosition=f(t.sellDate,e)}));P.append("text").attr("class","label-figure-small").attr("x",function(t){return t.xLeftPosition}).attr("y",function(t){return t.yLeftPosition}).attr("dx",-10).attr("dy",h.subTitleYShift).attr("text-anchor","end").text(function(t){return t.Date_of_sale.format("D MMM YYYY")}),P.append("text").attr("class","label-figure").attr("x",function(t){return t.xLeftPosition}).attr("y",function(t){return t.yLeftPosition}).attr("dx",-10).attr("dy",3).attr("text-anchor","end").text(function(t){return t.Lifting});y.append("circle").attr("class",function(t){return"circle"}).attr("r",h.radius).attr("cx",h.width*h.timelineWidthMultiple).attr("cy",function(t,e){return f(t.paymentDate,e)});var R=y.append("g").attr("class","slope-label-right").each(function(t,e){t.xRightPosition=h.width*h.timelineWidthMultiple+h.labelGroupOffset,t.yRightPosition=f(t.paymentDate,e)});R.append("text").attr("class","label-figure-small").attr("x",function(t){return t.xRightPosition}).attr("y",function(t){return t.yRightPosition}).attr("dx",10).attr("dy",2*h.subTitleYShift).attr("text-anchor","start").text(function(t){return t.Payment_receipt_date.format("D MMM YYYY")}),R.append("text").attr("class","label-figure").attr("x",function(t){return t.xRightPosition}).attr("y",function(t){return t.yRightPosition}).attr("dx",10).attr("dy",3).attr("text-anchor","start").text(function(t){return t.Buyer}),R.append("text").attr("class","label-figure").attr("x",function(t){return t.xRightPosition}).attr("y",function(t){return t.yRightPosition}).attr("dx",10).attr("dy",3+h.subTitleYShift).attr("text-anchor","start").text(function(t){return t.Destination});var T=l.append("g").attr("transform","translate(0,"+r.top+")").attr("class","title");T.append("text").attr("text-anchor","end").attr("x",r.left).attr("dx",-10).attr("dy",-r.top/4).text(h.leftTitle),T.append("text").attr("text-anchor","end").attr("class","label-figure-small").attr("x",r.left).attr("dx",-10).attr("dy",-r.top/4+h.subTitleYShift).text(h.leftSubTitle),T.append("text").attr("x",r.left+h.width*h.timelineWidthMultiple).attr("dx",10).attr("dy",-r.top/4).text(h.rightTitle1),T.append("text").attr("x",r.left+h.width*h.timelineWidthMultiple).attr("dx",10).attr("dy",-r.top/4+h.subTitleYShift).text(h.rightTitle2),T.append("text").attr("class","label-figure-small").attr("x",r.left+h.width*h.timelineWidthMultiple).attr("dx",10).attr("dy",-r.top/4+2*h.subTitleYShift).text(h.rightSubTitle);var Y=l.append("g").attr("transform","translate("+(r.left+h.width)+","+r.top+")").attr("class","price"),W=Object(D.a)().range([0,d.maxwidth]).domain([0,100]),_=Object(M.d)(t.map(function(t){return t.Revenue})),E=Object(D.a)().range([0,h.width]).domain([0,Math.sqrt(_)]);function k(t){return t.Lifting.split(" ").join("").toLowerCase()}var S=[],A=[];Y.selectAll(".bar").data(t).enter().append("rect").attr("class",function(t){return"bar price "+k(t)}).attr("x",function(t){return h.width*h.priceWidthMultiple}).attr("width",function(t){return W(+t.Price)}).attr("y",function(t,e){return t.yRightPosition-d.height/2}).attr("fill",function(t){return d.color}).attr("stroke",function(t){return d.border}).attr("height",function(t){return d.height}).on("mouseover",function(t){p.show(t,this),Object(w.b)("."+k(t)).attr("fill",d.highlightColor),Object(w.b)(".annote."+k(t)).attr("display","block")}).on("mouseout",function(t){p.hide(),Object(w.b)("."+k(t)).attr("fill",d.color),Object(w.b)(".annote."+k(t)).attr("display","none")}),a&&(A.push(l.append("g").attr("transform","translate("+(r.left+h.width*h.revWidthMultiple)+","+r.top+")").attr("class",function(t){return"rev"})),A[0].selectAll(".bar").data(t).enter().append("circle").attr("class",function(t){return"bar rev "+k(t)}).attr("cx",function(t){return h.width}).attr("r",function(t){return E(Math.sqrt(+t.Revenue))}).attr("cy",function(t){return t.yRightPosition}).attr("fill",function(t){return d.color}).attr("stroke",function(t){return d.border}).on("mouseover",function(t){p.show(t,this),Object(w.b)("."+k(t)).attr("fill",d.highlightColor),Object(w.b)(".annote."+k(t)).attr("display","block")}).on("mouseout",function(t){p.hide(),Object(w.b)("."+k(t)).attr("fill",d.color),Object(w.b)(".annote."+k(t)).attr("display","none")})),T.append("text").attr("text-anchor","start").attr("x",r.left+h.width*(h.priceWidthMultiple+1)).attr("dx",-10).attr("dy",-r.top/4).text(d.priceTitle1),T.append("text").attr("text-anchor","start").attr("x",r.left+h.width*(h.priceWidthMultiple+1)).attr("dx",-10).attr("dy",-r.top/4+h.subTitleYShift).text(d.priceTitle2),T.append("text").attr("text-anchor","start").attr("x",0).attr("dx",0).attr("dy",-r.top/4).text(d.volTitle),T.append("text").attr("text-anchor","start").attr("x",r.left+h.width*h.revWidthMultiple).attr("dx",0).attr("dy",-r.top/4).text(d.revTitle1),T.append("text").attr("x",r.left+h.width*h.revWidthMultiple).attr("dx",0).attr("dy",-r.top/4+h.subTitleYShift).text(d.revTitle2);var L=t.map(function(t){return b.a.range(0,Math.round(t.Volume/1e4))});console.log(L),t.forEach(function(e,n){S.push(l.append("g").attr("transform","translate(10,"+r.top+")").attr("class",function(t){return"volume"})),A.push(l.append("g").attr("transform","translate("+(r.left+h.width*h.revWidthMultiple)+","+r.top+")").attr("class",function(t){return"rev"})),S[n].selectAll(".bar").data(L[n]).enter().append("rect").attr("class",function(t){return"bar vol "+k(e)}).attr("x",function(t,e){return d.volWidth*e}).attr("width",function(t){return d.volWidth}).attr("y",function(t,a){return e.yLeftPosition-d.height/2}).attr("fill",function(t){return d.color}).attr("stroke",function(t){return d.border}).attr("height",function(t){return d.height}).on("mouseover",function(t){p.show(e,this),Object(w.b)("."+k(e)).attr("fill",d.highlightColor),Object(w.b)(".annote."+k(e)).attr("display","block")}).on("mouseout",function(t){p.hide(),Object(w.b)("."+k(e)).attr("fill",d.color),Object(w.b)(".annote."+k(e)).attr("display","none")}),a||A[n].selectAll(".bar").data(L[n]).enter().append("rect").attr("class",function(t){return"bar rev "+k(e)}).attr("x",function(t,a){var n=W(+e.Price);return Math.floor(a/d.revBoxesPerCol)*n}).attr("width",function(t){return W(+e.Price)}).attr("y",function(a,r){var i=r%d.revBoxesPerCol,o=e.yRightPosition-d.height/2+d.height*i;return t[n].yRevBottom=t[n].yRevBottom>o+d.height?t[n].yRevBottom:o+d.height,o}).attr("fill",function(t){return d.color}).attr("stroke",function(t){return d.border}).attr("height",function(t){return d.height}).on("mouseover",function(t){p.show(e,this),Object(w.b)("."+k(e)).attr("fill",d.highlightColor),Object(w.b)(".annote."+k(e)).attr("display","block")}).on("mouseout",function(t){p.hide(),Object(w.b)("."+k(e)).attr("fill",d.color),Object(w.b)(".annote."+k(e)).attr("display","none")}),l.append("g").attr("transform","translate(0,"+r.top+")").append("text").attr("text-anchor","left").attr("class",function(t){return"annote vol "+k(e)}).attr("x",10).attr("dx",0).attr("y",e.yLeftPosition-10).attr("fill",d.color).attr("display","none").text(s(e.Volume)+" barrels"),l.append("g").attr("transform","translate(0,"+r.top+")").append("text").attr("text-anchor","middle").attr("class",function(t){return"annote price "+k(e)}).attr("x",r.left+h.width*(h.priceWidthMultiple+1.25)).attr("dx",0).attr("y",e.yRightPosition).attr("dy",-10).attr("fill",d.color).attr("display","none").text("US$ "+s(e.Price)+" per barrel"),l.append("g").attr("transform","translate(0,"+r.top+")").append("text").attr("text-anchor","left").attr("class",function(t){return"annote rev "+k(e)}).attr("x",function(){var t=r.left+h.width*(h.revWidthMultiple+.5);return a?t-h.width:t}).attr("dx",0).attr("y",function(r){t[n].yRevTop=e.yRightPosition-30;var i=e.yRightPosition-10;return a?i-h.width:i}).attr("fill",d.color).attr("display","none").text("US$ "+s(e.Revenue)+" in revenue ")}),console.log(t);for(var B=0,N=t.length-1;N>0;N--)for(var V=t.length-1;V>0;V--)if((B=t[V-1].yRevBottom>t[V].yRevTop?t[V-1].yRevBottom-t[V].yRevTop:0)>0){Object(w.b)(".rev."+k(t[V-1])).attr("transform","translate(0,"+-B+")"),t[V-1].yRevBottom-=B,t[V-1].yRevTop-=B;break}l.call(p)}},{key:"render",value:function(){var t=this;this.props.data&&this.props.data;return r.a.createElement("div",{className:"MainVizComponent"},r.a.createElement("svg",{className:"MainChart",ref:function(e){return t.node=e},width:this.props.width,height:this.state.height}))}}]),e}(n.Component);P.defaultProps={};var R=P,T=a(85),Y=a(62),W=a.n(Y),_=a(86),E=function(t){function e(){var t;return Object(c.a)(this,e),(t=Object(h.a)(this,Object(d.a)(e).call(this))).state=Object(s.a)({},t.props,{dimensions:{width:window.innerWidth,height:window.innerHeight},data:[],timeline:!1,revAsCircles:!0}),t.handleTimeLineChange=t.handleTimeLineChange.bind(Object(p.a)(t)),t.handleFilterYearChange=t.handleFilterYearChange.bind(Object(p.a)(t)),t.handleRevAsCirclesChange=t.handleRevAsCirclesChange.bind(Object(p.a)(t)),t.updateDimensions=t.updateDimensions.bind(Object(p.a)(t)),t}return Object(f.a)(e,t),Object(u.a)(e,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.updateDimensions),this.getData(),console.log("mounted")}},{key:"updateDimensions",value:function(){this.setState({dimensions:{height:window.innerHeight,width:window.innerWidth}})}},{key:"handleTimeLineChange",value:function(t){this.setState({timeline:t})}},{key:"handleRevAsCirclesChange",value:function(t){this.setState({revAsCircles:t})}},{key:"handleFilterYearChange",value:function(t){console.log(t);var e="All"===t?this.state.data:this.state.data.filter(function(e){return e.Date_of_sale.year()===+t});this.setState({filteredData:e})}},{key:"getData",value:function(){var t=this;(function(){var t=[];return t.push(Object(g.a)(y.a)),Promise.all(t).then(function(t){console.log(t);var e=[];return t[0].forEach(function(t){t.Date_of_sale=v(t.Date_of_sale,"YYYY-MM-DD"),t.Payment_receipt_date=v(t.Payment_receipt_date,"YYYY-MM-DD"),e.push(t)}),e})})().then(function(e){var a=["All"].concat(Object(l.a)(b.a.uniq(e.map(function(t){return t.Date_of_sale.year()}))));t.setState({data:e,filteredData:e,years:a})})}},{key:"render",value:function(){return console.log(this.state.data),!!b.a.isEmpty(this.state.data)?null:r.a.createElement("div",{className:"App"},r.a.createElement("header",null,r.a.createElement("div",{className:"application"},r.a.createElement(T.Helmet,null,r.a.createElement("meta",{charSet:"utf-8"}),r.a.createElement("meta",{name:"viewport",content:"width=1100,initial-scale=0.3,shrink-to-fit=yes"})))),r.a.createElement("div",{className:"uiWidgetContainer"},r.a.createElement("label",null,r.a.createElement("span",null,"Revenue as Circles"),r.a.createElement("br",null),r.a.createElement(W.a,{onChange:this.handleRevAsCirclesChange,checked:this.state.revAsCircles}))),r.a.createElement("div",{className:"uiWidgetContainer"},r.a.createElement("label",null,r.a.createElement("span",null,"Timeline View"),r.a.createElement("br",null),r.a.createElement(W.a,{onChange:this.handleTimeLineChange,checked:this.state.timeline}))),r.a.createElement("div",{className:"uiWidgetContainer"},"Filter by year:",r.a.createElement(_.Combobox,{data:this.state.years,defaultValue:"All",onChange:this.handleFilterYearChange})),r.a.createElement("div",{className:"vizContainer"},r.a.createElement(R,{data:this.state.filteredData,width:.95*this.state.dimensions.width,timeline:this.state.timeline,revAsCircles:this.state.revAsCircles})))}}]),e}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(E,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},83:function(t,e,a){t.exports=a.p+"static/media/gnpc_commodity_exports.97d62662.csv"},90:function(t,e,a){t.exports=a(158)},95:function(t,e,a){},96:function(t,e,a){t.exports=a.p+"static/media/logo.5d5d9eef.svg"},97:function(t,e,a){},99:function(t,e,a){}},[[90,1,2]]]);
//# sourceMappingURL=main.7dfcaacd.chunk.js.map