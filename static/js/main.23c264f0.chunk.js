(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(t,e,a){},104:function(t,e,a){t.exports=a.p+"static/media/logo.5d5d9eef.svg"},105:function(t,e,a){},107:function(t,e,a){},170:function(t,e,a){"use strict";a.r(e);var n=a(1),r=a.n(n),i=a(13),o=a.n(i),l=(a(103),a(20)),s=a(96),c=a(22),u=a(57),h=a(58),d=a(61),f=a(59),p=a(21),m=a(60),g=(a(104),a(105),a(106),a(30)),b=a.n(g),v=a(55),x=(a(17),a(18)),y=a(90),D=a.n(y),O=(a(107),a(0)),w=a(29),j=a(172),C=a(54),P=a(56),k=a(8),M=a(91),R=a(6),T=a(2),Y=a(92),_=a(25),E=function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(d.a)(this,Object(f.a)(e).call(this,t))).setHeightFromDateExtant=function(t,e){return a.setHeight(e.diff(t,"months"))},a.setHeight=function(t){return 180*t+500},a.createChart=a.createChart.bind(Object(p.a)(a)),a.state={height:4e3},a}return Object(m.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){console.log(this.props),this.setState({height:this.props.timeline?this.setHeightFromDateExtant(this.props.minDate,this.props.maxDate):this.setHeight(this.props.data.length),months:this.props.timeline?this.props.maxDate.diff(this.props.minDate,"months"):0}),this.createChart()}},{key:"componentDidUpdate",value:function(){this.createChart()}},{key:"componentWillReceiveProps",value:function(t){t.data===this.props.data&&t.timeline===this.props.timeline||this.setState({height:t.timeline?this.setHeightFromDateExtant(t.minDate,t.maxDate):this.setHeight(t.data.length),months:t.timeline?t.maxDate.diff(t.minDate,"months"):0})}},{key:"createChart",value:function(){var t=this.props.data?this.props.data:[],e=this.props,a=e.revAsCircles,n=e.timeline,r={top:150,right:5,bottom:5,left:this.props.width/3},i=this.props.width-r.left-r.right,o=this.state.height-r.top-r.bottom,l=Object(O.k)(this.node);console.log(t),console.log(a),(t=b.a.sortBy(t,"Date_of_sale")).forEach(function(t){t.yRevBottom=0,t.yRevTop=0});var s=Object(k.a)(",.2f"),c=Object(w.a)().range([o,0]),u=Object(w.a)().range([o,0]),h={xOffset:0,yOffset:0,width:i/8,height:o,labelPositioning:{alpha:.5,spacing:18},leftTitle:"Lifting",rightTitle1:"Buyer",rightTitle2:"& Destination",leftSubTitle:"Date of Sale",rightSubTitle:"Payment Due Date",labelGroupOffset:5,labelKeyOffset:50,radius:6,subTitleYShift:20,unfocusOpacity:.3,revWidthMultiple:3.5,priceWidthMultiple:1.5,timelineWidthMultiple:.6},d={maxwidth:i/15>20?i/15:20,height:10,color:"#ecb600",highlightColor:"#CE1126",border:"#eee",volWidth:2.5,revBoxesPerCol:10,maxRevWidth:400,volTitle:"Volume (barrels)",priceTitle1:"Price",priceTitle2:"(US$)",revTitle1:"Revenue",revTitle2:"(US$)"},f=Object(M.a)().attr("class","d3-tip").offset([0,20]).direction(function(t){return a?"e":"se"}).html(function(t){return function(t,e){var a="<div class='tootltip' style='font-size:12px; border: 1px solid #ccc; background-color: rgba(255,255,255,0.9); padding:5px; max-width:350px; z-index:2000'>";return a+=t?"<div style='font-size:20px'>"+t+"</div>":"",e&&e.forEach(function(t){a+="<br/><strong>"+t.label+":</strong> ",a+="<div class='tootltip-value' style='font-size:18px;'>"+t.value+"</div>"}),a+="</div>"}(t.year,[{label:"Lifting",value:t.Lifting},{label:"Date of Sale",value:t.Date_of_sale.format("D MMM YYYY")},{label:"Payment Receipt Date",value:t.Payment_receipt_date.format("D MMM YYYY")},{label:"Price",value:"US$ "+s(t.Price)+" per barrel"},{label:"Volume",value:s(t.Volume)+" barrels"},{label:"Revenue",value:"US$ "+s(t.Revenue)},{label:"Buyer",value:t.Buyer},{label:"Destination",value:t.Destination}])});l.selectAll("g").remove();Object(j.a)(C.B).domain([0,10]),Object(_.f)("%s");var p=function(t,e){return n?c(t):u(e)},m=x(x.max(t.map(function(t){return t.Payment_receipt_date})).toDate()),g=x(x.min(t.map(function(t){return t.Date_of_sale})).toDate());c.domain([T.n.floor(m.add(2,"months")),T.n.floor(g.subtract(1,"months"))]),u.domain([t.length,-1]),console.log(c.domain()),console.log(T.n.range(T.n.floor(c.domain()[0]),T.n.ceil(c.domain()[1]))),n&&l.append("g").attr("class","grid").attr("transform","translate(0,"+r.top+")").call(function(t,e,a){return console.log(e,a),console.log(T.n.range(e,a).map(function(t){return+t})),Object(P.b)(c).tickValues(T.n.range(e,a).map(function(t){return+t}))}(this.state.months,c.domain()[1],c.domain()[0]).tickSize(2*-i).tickFormat(function(t){return Object(_.c)("%b %Y")(t)})),l.selectAll(".grid text").attr("dy",20).attr("dx",10);var v=l.append("g").attr("class","borderLines").attr("transform","translate("+r.left+","+r.top+")");v.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",h.height),v.append("line").attr("x1",h.width*h.timelineWidthMultiple).attr("y1",0).attr("x2",h.width*h.timelineWidthMultiple).attr("y2",h.height);var y=l.append("g").selectAll("g").data(t).enter().append("g").attr("transform","translate("+r.left+","+r.top+")").attr("class","slope-group").attr("id",function(t,e){t.id="group"+t.Lifting,t.sellDate=t.Date_of_sale.toDate(),t.paymentDate=t.Payment_receipt_date.toDate()}),D=(y.append("line").attr("class","slope-line").attr("x1",0).attr("y1",function(t,e){return p(t.sellDate,e)}).attr("x2",h.width*h.timelineWidthMultiple).attr("y2",function(t,e){return p(t.paymentDate,e)}),y.append("circle").attr("class",function(t){return"circle"}).attr("r",h.radius).attr("cy",function(t,e){return p(t.sellDate,e)}),y.append("g").attr("class","slope-label-left").each(function(t,e){t.xLeftPosition=-h.labelGroupOffset,t.yLeftPosition=p(t.sellDate,e)}));D.append("text").attr("class","label-figure-small").attr("x",function(t){return t.xLeftPosition}).attr("y",function(t){return t.yLeftPosition}).attr("dx",-10).attr("dy",h.subTitleYShift).attr("text-anchor","end").text(function(t){return t.Date_of_sale.format("D MMM YYYY")}),D.append("text").attr("class","label-figure").attr("x",function(t){return t.xLeftPosition}).attr("y",function(t){return t.yLeftPosition}).attr("dx",-10).attr("dy",3).attr("text-anchor","end").text(function(t){return t.Lifting});y.append("circle").attr("class",function(t){return"circle"}).attr("r",h.radius).attr("cx",h.width*h.timelineWidthMultiple).attr("cy",function(t,e){return p(t.paymentDate,e)});var E=y.append("g").attr("class","slope-label-right").each(function(t,e){t.xRightPosition=h.width*h.timelineWidthMultiple+h.labelGroupOffset,t.yRightPosition=p(t.paymentDate,e)});E.append("text").attr("class","label-figure-small").attr("x",function(t){return t.xRightPosition}).attr("y",function(t){return t.yRightPosition}).attr("dx",10).attr("dy",2*h.subTitleYShift).attr("text-anchor","start").text(function(t){return t.Payment_receipt_date.format("D MMM YYYY")}),E.append("text").attr("class","label-figure").attr("x",function(t){return t.xRightPosition}).attr("y",function(t){return t.yRightPosition}).attr("dx",10).attr("dy",3).attr("text-anchor","start").text(function(t){return t.Buyer}),E.append("text").attr("class","label-figure").attr("x",function(t){return t.xRightPosition}).attr("y",function(t){return t.yRightPosition}).attr("dx",10).attr("dy",3+h.subTitleYShift).attr("text-anchor","start").text(function(t){return t.Destination});var A=l.append("g").attr("transform","translate(0,"+r.top+")").attr("class","title");A.append("text").attr("text-anchor","end").attr("x",r.left).attr("dx",-10).attr("dy",-r.top/4).text(h.leftTitle),A.append("text").attr("text-anchor","end").attr("class","label-figure-small").attr("x",r.left).attr("dx",-10).attr("dy",-r.top/4+h.subTitleYShift).text(h.leftSubTitle),A.append("text").attr("x",r.left+h.width*h.timelineWidthMultiple).attr("dx",10).attr("dy",-r.top/4).text(h.rightTitle1),A.append("text").attr("x",r.left+h.width*h.timelineWidthMultiple).attr("dx",10).attr("dy",-r.top/4+h.subTitleYShift).text(h.rightTitle2),A.append("text").attr("class","label-figure-small").attr("x",r.left+h.width*h.timelineWidthMultiple).attr("dx",10).attr("dy",-r.top/4+2*h.subTitleYShift).text(h.rightSubTitle);var S=l.append("g").attr("transform","translate("+(r.left+h.width)+","+r.top+")").attr("class","price"),W=Object(w.a)().range([0,d.maxwidth]).domain([0,100]),B=Object(R.c)(t.map(function(t){return t.Revenue})),L=Object(w.a)().range([0,h.width]).domain([0,Math.sqrt(B)]);function F(t){return t.Lifting.split(" ").join("").toLowerCase()}var V=[],$=[];S.selectAll(".bar").data(t).enter().append("rect").attr("class",function(t){return"bar price "+F(t)}).attr("x",function(t){return h.width*h.priceWidthMultiple}).attr("width",function(t){return W(+t.Price)}).attr("y",function(t,e){return t.yRightPosition-d.height/2}).attr("fill",function(t){return d.color}).attr("stroke",function(t){return d.border}).attr("height",function(t){return d.height}).on("mouseover",function(t){f.show(t,this),Object(O.l)("."+F(t)).attr("fill",d.highlightColor),Object(O.l)(".annote."+F(t)).attr("display","block")}).on("mouseout",function(t){f.hide(),Object(O.l)("."+F(t)).attr("fill",d.color),Object(O.l)(".annote."+F(t)).attr("display","none")}),a&&($.push(l.append("g").attr("transform","translate("+(r.left+h.width*h.revWidthMultiple)+","+r.top+")").attr("class",function(t){return"rev"})),$[0].selectAll(".bar").data(t).enter().append("circle").attr("class",function(t){return"bar rev "+F(t)}).attr("cx",function(t){return h.width}).attr("r",function(t){return L(Math.sqrt(+t.Revenue))}).attr("cy",function(t){return t.yRightPosition}).attr("fill",function(t){return d.color}).attr("stroke",function(t){return d.border}).on("mouseover",function(t){f.show(t,this),Object(O.l)("."+F(t)).attr("fill",d.highlightColor),Object(O.l)(".annote."+F(t)).attr("display","block")}).on("mouseout",function(t){f.hide(),Object(O.l)("."+F(t)).attr("fill",d.color),Object(O.l)(".annote."+F(t)).attr("display","none")})),A.append("text").attr("text-anchor","start").attr("x",r.left+h.width*(h.priceWidthMultiple+1)).attr("dx",-10).attr("dy",-r.top/4).text(d.priceTitle1),A.append("text").attr("text-anchor","start").attr("x",r.left+h.width*(h.priceWidthMultiple+1)).attr("dx",-10).attr("dy",-r.top/4+h.subTitleYShift).text(d.priceTitle2),A.append("text").attr("text-anchor","start").attr("x",0).attr("dx",0).attr("dy",-r.top/4).text(d.volTitle),A.append("text").attr("text-anchor","start").attr("x",r.left+h.width*h.revWidthMultiple).attr("dx",0).attr("dy",-r.top/4).text(d.revTitle1),A.append("text").attr("x",r.left+h.width*h.revWidthMultiple).attr("dx",0).attr("dy",-r.top/4+h.subTitleYShift).text(d.revTitle2);var H=t.map(function(t){return b.a.range(0,Math.round(t.Volume/1e4))});t.forEach(function(e,n){V.push(l.append("g").attr("transform","translate(10,"+r.top+")").attr("class",function(t){return"volume"})),$.push(l.append("g").attr("transform","translate("+(r.left+h.width*h.revWidthMultiple)+","+r.top+")").attr("class",function(t){return"rev"})),V[n].selectAll(".bar").data(H[n]).enter().append("rect").attr("class",function(t){return"bar vol "+F(e)}).attr("x",function(t,e){return d.volWidth*e}).attr("width",function(t){return d.volWidth}).attr("y",function(t,a){return e.yLeftPosition-d.height/2}).attr("fill",function(t){return d.color}).attr("stroke",function(t){return d.border}).attr("height",function(t){return d.height}).on("mouseover",function(t){f.show(e,this),Object(O.l)("."+F(e)).attr("fill",d.highlightColor),Object(O.l)(".annote."+F(e)).attr("display","block")}).on("mouseout",function(t){f.hide(),Object(O.l)("."+F(e)).attr("fill",d.color),Object(O.l)(".annote."+F(e)).attr("display","none")}),a||$[n].selectAll(".bar").data(H[n]).enter().append("rect").attr("class",function(t){return"bar rev "+F(e)}).attr("x",function(t,a){var n=W(+e.Price);return Math.floor(a/d.revBoxesPerCol)*n}).attr("width",function(t){return W(+e.Price)}).attr("y",function(a,r){var i=r%d.revBoxesPerCol,o=e.yRightPosition-d.height/2+d.height*i;return t[n].yRevBottom=t[n].yRevBottom>o+d.height?t[n].yRevBottom:o+d.height,o}).attr("fill",function(t){return d.color}).attr("stroke",function(t){return d.border}).attr("height",function(t){return d.height}).on("mouseover",function(t){f.show(e,this),Object(O.l)("."+F(e)).attr("fill",d.highlightColor),Object(O.l)(".annote."+F(e)).attr("display","block")}).on("mouseout",function(t){f.hide(),Object(O.l)("."+F(e)).attr("fill",d.color),Object(O.l)(".annote."+F(e)).attr("display","none")}),l.append("g").attr("transform","translate(0,"+r.top+")").append("text").attr("text-anchor","left").attr("class",function(t){return"annote vol "+F(e)}).attr("x",10).attr("dx",0).attr("y",e.yLeftPosition-10).attr("fill",d.color).attr("display","none").text(s(e.Volume)+" barrels"),l.append("g").attr("transform","translate(0,"+r.top+")").append("text").attr("text-anchor","middle").attr("class",function(t){return"annote price "+F(e)}).attr("x",r.left+h.width*(h.priceWidthMultiple+1.25)).attr("dx",0).attr("y",e.yRightPosition).attr("dy",-10).attr("fill",d.color).attr("display","none").text("US$ "+s(e.Price)+" per barrel"),l.append("g").attr("transform","translate(0,"+r.top+")").append("text").attr("text-anchor","left").attr("class",function(t){return"annote rev "+F(e)}).attr("x",function(){var t=r.left+h.width*(h.revWidthMultiple+.5);return a?t-h.width:t}).attr("dx",0).attr("y",function(r){t[n].yRevTop=e.yRightPosition-30;var i=e.yRightPosition-10;return a?i-h.width:i}).attr("fill",d.color).attr("display","none").text("US$ "+s(e.Revenue)+" in revenue ")}),console.log(t);for(var z=0,N=t.length-1;N>0;N--)for(var U=t.length-1;U>0;U--)if((z=t[U-1].yRevBottom>t[U].yRevTop?t[U-1].yRevBottom-t[U].yRevTop:0)>0){Object(O.l)(".rev."+F(t[U-1])).attr("transform","translate(0,"+-z+")"),t[U-1].yRevBottom-=z,t[U-1].yRevTop-=z;break}l.call(f),Object(O.k)(".MainChart").call(Object(Y.downloadable)())}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"MainVizComponent"},r.a.createElement("svg",{className:"MainChart",ref:function(e){return t.node=e},width:this.props.width,height:this.state.height}))}}]),e}(n.Component);E.defaultProps={};var A=E,S=a(93),W=a(94),B=a.n(W),L=a(95),F=a(171),V=function(t){function e(){var t;return Object(u.a)(this,e),(t=Object(d.a)(this,Object(f.a)(e).call(this))).getDateExtent=function(t){return t.length?Object(R.b)([].concat(Object(c.a)(t.map(function(t){return t.Date_of_sale})),Object(c.a)(t.map(function(t){return t.Payment_receipt_date})))):[x(),x()]},t.makeAFilterCombo=function(e){return r.a.createElement("div",{className:"uiWidgetContainer"},"Filter by ",e,":",r.a.createElement(L.Combobox,{data:t.state[e+"Options"],defaultValue:"All",onChange:function(a){return t.handleAllFilters({filter:e,filterVal:a})}}))},t.state=Object(s.a)({},t.props,{dimensions:{width:window.innerWidth,height:window.innerHeight},currentFilters:[],data:[],timeline:!0,revAsCircles:!1}),t.handleTimeLineChange=t.handleTimeLineChange.bind(Object(p.a)(t)),t.handleFilterYearChange=t.handleFilterYearChange.bind(Object(p.a)(t)),t.handleBuyerChange=t.handleBuyerChange.bind(Object(p.a)(t)),t.handleRevAsCirclesChange=t.handleRevAsCirclesChange.bind(Object(p.a)(t)),t.updateDimensions=t.updateDimensions.bind(Object(p.a)(t)),t}return Object(m.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.updateDimensions),this.getData(),console.log("mounted")}},{key:"updateDimensions",value:function(){this.setState({dimensions:{height:window.innerHeight,width:window.innerWidth}})}},{key:"handleTimeLineChange",value:function(t){this.setState({timeline:t})}},{key:"handleRevAsCirclesChange",value:function(t){this.setState({revAsCircles:t})}},{key:"handleFilterYearChange",value:function(t,e){return"All"===t?e:e.filter(function(e){return e.Date_of_sale.year()===+t})}},{key:"handleBuyerChange",value:function(t,e){return"All"===t?e:e.filter(function(e){return e.Buyer===t})}},{key:"handleDestinationChange",value:function(t,e){return"All"===t?e:e.filter(function(e){return e.Destination===t})}},{key:"handlePriceChange",value:function(t,e){var a=this;return"All"===t?e:e.filter(function(e){return e.priceRange===a.state.priceOptions.indexOf(t)-1})}},{key:"handleAllFilters",value:function(t){var e=Object(c.a)(this.state.data),a=this.state.currentFilters.map(function(e){return t.filter===e.filter?{filter:e.filter,filterVal:t.filterVal}:{filter:e.filter,filterVal:e.filterVal}});console.log(a);var n=a.concat(a.map(function(t){return t.filter}).includes(t.filter)?[]:[t]);console.log(e),console.log(n);for(var r=0;r<n.length;r++)switch(n[r].filter){case"year":e=this.handleFilterYearChange(n[r].filterVal,e);break;case"buyer":e=this.handleBuyerChange(n[r].filterVal,e);break;case"destination":e=this.handleDestinationChange(n[r].filterVal,e);break;case"price":e=this.handlePriceChange(n[r].filterVal,e)}var i=this.getDateExtent(e),o=Object(l.a)(i,2),s=o[0],u=o[1];this.setState({filteredData:e}),this.setState({currentFilters:n}),this.setState({minDate:s}),this.setState({maxDate:u})}},{key:"getData",value:function(){var t=this;(function(){var t=[];return t.push(Object(v.c)(D.a)),Promise.all(t).then(function(t){console.log(t);var e=[];return t[0].forEach(function(t){t.Date_of_sale=x(t.Date_of_sale,"YYYY-MM-DD"),t.Payment_receipt_date=x(t.Payment_receipt_date,"YYYY-MM-DD"),e.push(t)}),e})})().then(function(e){var a=e.map(function(t){return t.Price}),n=Object(F.a)().domain(Object(R.b)(a)).range(Object(c.a)(Array(4).keys())).copy().nice(),r=n.thresholds(),i=r.map(function(t,e){return e>0?"$"+r[e-1]+" to $"+t:"$0 to $"+t});i.push(">$"+r[r.length-1]),i.unshift("All"),console.log(i);var o=e.map(function(t){var e={};return Object.keys(t).forEach(function(a){return e[a]="string"===typeof t[a]?t[a].trim():t[a]}),e.priceRange=n(t.Price),e});console.log(o);var s=t.getDateExtent(o),u=Object(l.a)(s,2),h=u[0],d=u[1],f=["All"].concat(Object(c.a)(b.a.uniq(o.map(function(t){return t.Date_of_sale.year()})))),p=["All"].concat(Object(c.a)(b.a.uniq(o.map(function(t){return t.Buyer})))),m=["All"].concat(Object(c.a)(b.a.uniq(o.map(function(t){return t.Destination}))));t.setState({data:o,filteredData:e,yearOptions:f,buyerOptions:p,destinationOptions:m,priceOptions:i,maxDate:d,minDate:h})})}},{key:"render",value:function(){return!!b.a.isEmpty(this.state.data)?null:r.a.createElement("div",{className:"App"},r.a.createElement("header",null,r.a.createElement("div",{className:"application"},r.a.createElement(S.Helmet,null,r.a.createElement("meta",{charSet:"utf-8"}),r.a.createElement("meta",{name:"viewport",content:"width=1100,initial-scale=0.3,shrink-to-fit=yes"})))),r.a.createElement("div",{className:"uiWidgetContainer"},r.a.createElement("label",null,r.a.createElement("span",null,"Timeline View"),r.a.createElement("br",null),r.a.createElement(B.a,{onChange:this.handleTimeLineChange,checked:this.state.timeline}))),this.makeAFilterCombo("buyer"),this.makeAFilterCombo("destination"),this.makeAFilterCombo("year"),this.makeAFilterCombo("price"),r.a.createElement("br",null),r.a.createElement("br",null),"Right click on the visualisation to save as an image.",r.a.createElement("div",{className:"vizContainer"},r.a.createElement(A,{data:this.state.filteredData,width:.95*this.state.dimensions.width>1200?.95*this.state.dimensions.width:1200,timeline:this.state.timeline,revAsCircles:this.state.revAsCircles,maxDate:this.state.maxDate,minDate:this.state.minDate})))}}]),e}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(V,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},90:function(t,e,a){t.exports=a.p+"static/media/gnpc_commodity_exports.97d62662.csv"},98:function(t,e,a){t.exports=a(170)}},[[98,1,2]]]);
//# sourceMappingURL=main.23c264f0.chunk.js.map